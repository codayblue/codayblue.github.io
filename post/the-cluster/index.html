<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>The Cluster :: Blue Moss Media â€” Where tech points north</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="So one morning I woke up and went on to the internet and was looking at prices for cloud computing for a project I was getting ready start. Cloud computing has gotten super cheap over the years and it has made the power of a datacenter available to so many people. Then I got to thinking, what would it take for me to build a cloud in my home. Crazy I know."/>
<meta name="keywords" content="Cody Moss bluemossmedia technology kubernetes docker devops raspberry pi"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/post/the-cluster/" />





<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="The Cluster"/>
<meta name="twitter:description" content="So one morning I woke up and went on to the internet and was looking at prices for cloud computing for a project I was getting ready start. Cloud computing has gotten super cheap over the years and it has made the power of a datacenter available to so many people. Then I got to thinking, what would it take for me to build a cloud in my home. Crazy I know."/>



<meta property="og:title" content="The Cluster" />
<meta property="og:description" content="So one morning I woke up and went on to the internet and was looking at prices for cloud computing for a project I was getting ready start. Cloud computing has gotten super cheap over the years and it has made the power of a datacenter available to so many people. Then I got to thinking, what would it take for me to build a cloud in my home. Crazy I know." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/the-cluster/" />
<meta property="article:published_time" content="2019-09-25T21:20:36-07:00" />
<meta property="article:modified_time" content="2019-09-25T21:20:36-07:00" /><meta property="og:site_name" content="Blue Moss Media" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">blue moss media</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="https://github.com/codayblue">Github</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="https://github.com/codayblue">Github</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/post/the-cluster/">The Cluster</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-09-25
        </span>
      
      
      
    </div>

    

    
      
        <img src="/post/the-cluster/images/before_build.jpg" class="post-cover" />
      
    

    <div class="post-content">
      <p>So one morning I woke up and went on to the internet and was looking at prices for cloud computing for a project I was getting ready start. Cloud computing has gotten super cheap over the years and it has made the power of a datacenter available to so many people. Then I got to thinking, what would it take for me to build a cloud in my home. Crazy I know. Overkill probably. Worth the knowledge I gained most defintely. So take a moment grab a cup of coffee and join me on a journey of building my own personal cloud.</p>

<p>Now to be clear. This is just a starting point. A cluster is most defintely not a &ldquo;cloud&rdquo; but it is what I consider a good first step. In the image above you see my desk. A mess I know. My wife reminds me of that every time she cleans my desk (Once every 6 months or so (of her own free will)). That is besides the point. The parts on the edge of the desk are the important bit. These are parts I picked out for a small home cluster. Now explaining to my CFO (my wife) why I needed all these parts was another task. I can not help you there. Although I think she got it. That or got tired of me asking. Here is the list for all those items:</p>

<ul>
<li>5 raspberry pi modal 3 b+</li>
<li>6 cat 6 network cables (one to connect the router to the switch)</li>
<li>1 8 port switch</li>
<li>1 usb power hub (the one in the pic did not work. I went with a 10 port anker power hub from amazon)</li>
<li>5 usb cables</li>
<li>5 pi cases</li>
<li>5 32gb micro sd cards</li>
</ul>

<p>Now the question I get the most besides why did I build my own cluster is why did I choose the raspberry pi. Well frankly because it is cheap, all 5 running pulls hardly any power, and they are very capible machines for all the tasks I have thought of for my home projects. Now that first question is pretty much why not?! I learned a lot working on this project and also I have given talks on this technology at meetups and conferences so I should know how to install it from scratch rather then just run it in the cloud all the time. Atleast that is my view point. Any way back to the task at hand. We have the parts, the CFO is confused, my room mate is sleeping, LETS GET TO WORK!</p>


  <img src="images/setup.jpg"  alt="Pi cluster setup and running"  class="center"  style="border-radius: 8px"  />



<p>So this was not just out of the blue. No pun intended. I had gotten a Pi model 3 b (no +) for christmas a year or two before this project from my wife. I tinkered with it so much, turning it into a pi hole, retropi, etc.. Then I came across <a href="https://twitter.com/alexellisuk">Alex Ellis</a>, the creator of OpenFAAS. He had a bunch of blog posts about spinning up kubernetes on the pis. He also had a very easy to follow guide (<a href="https://github.com/teamserverless/k8s-on-raspbian">Link to the Guide</a>). Now if you take a look through that guide you will see it is pretty simple. I remember when I first saw that guide it did not mention K3s. It was easy to follow and had all the shell scripts you need to get up and running. Fast foreward to to now. That guide mentions K3s. I have enjoyed that project. It now runs on my cluster. It was easy enough to tear down the old cluster run a couple of the curl bash (yes I know, bad) commands and boom you have a cluster. I mean it really is that easy. Then I just ran all my kubernetes configs against it and it was up in running in about 15 minutes. Most of that was reading docs.</p>

<p>There were some steps before that though that we just skipped over. Lets start from the beginning. So first things first I started opening all the goods. The cases, pis, cabels, sd cards, switch, and power supply. Once I had all that open I had to set it all up. Well first I download raspbain stretch lite off of the offical raspberry pi foundation site. After that took about 20 or 30 minutes to flash every sd card. Really was mind numbing waiting for all them to flash, see if you can get the multiflash thing from the people that make etcher. That will make your life 1000% easier here. Also while flashing to get ssh enabled so you dont have to connect a monitor and keyboard to all the pis for the intial setup is just going into the boot partition of each sd card and creating a blank ssh file with no extesion (heard windows likes to add them even though you dont see them). After that I connected the switch to my laptop and configured it to my subnet and gave it an ip outside of my dhcp range. You can avoid that if you buy a managed switch. Then it was just wiring it all up and turning on the pis. I used my router to see what ip they all got in the dhcp pool and just went through and updated each pi and gave them a static ip. After that I copied over my ssh key to make it so I can login without a password. Then I googled how to harden the pi setup and went through the first 5 or so articles and guides and followed what made since. Such as making the pi user require a password for sudo and down also just removing that user once I made my own admin. Then after that you just follow the K3s guide then you should be done at that point.</p>

<p>Now I have this cluster. You are probably wondering what I run on it. Right now it is just host my DNS server. I use CoreDNS with the host plugin and the cache plugin to give all my machines domain names so I dont have to remember the ip addresses. I am aiming for everything to be dhcp as well. More on that later once I have figured it out. So all and all I am happy with it and I plan to try to put other things on the cluster in the future and if I see interest I will plan to write a post on software I deploy on it.</p>

    </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">&COPY;2018-2019</div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
